<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>找空间module</title>
    <style>
        body{
            padding: 0px;
            margin: 0px;
        }
        /*筛选条件css*/
        .paixu_shaixuan_box{
            width: 100%;
            height: 20px;
            position: relative;
            display: flex;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: -webkit-box;
            margin-top:2px;
        }
        .paixu_box,.shaixuan_box{
            width: 46%;
            margin-left:3%;
            height: auto;
        }
        #choosepaixu_box,#chooseshaixun_box{
            background:#ffffff;
            z-index: 99999;
            position: relative;
            top:-30px;
            left: -3px;
        }
        .flag_ico{
            background-image: url('../../image/todown.png');
            background-repeat: no-repeat;
            height: 30px;
            background-size: auto 10px;
            background-position: 8px center;
            width: 30px;
            position: relative;
            top: -25px;
            left: 74%;
        }
        input{
            border:0;
            width: 80%;
            background-color:transparent;
            outline: none;
        }
        ul{
            padding: 0; 
            margin: 0;
            width:90%;
            box-shadow: 1px 1px 1px 1px #DCDCDC;
        }
        .paixu_word_item,.shaixuan_word_item{
            width: auto;
            list-style-type: none;
            margin-left: 0;
            border-bottom: 1px solid #DCDCDC;
            padding:2px;
        }
        #space_box{
            width:100%;
            height: auto;
        }
        .itembox{
            pointer-events: auto;
            top:1px;
            position: relative;
            width: 98%;
            height:220px;
            margin: 0 auto;
            background-color: rgb(250, 250, 250);
            border-color: transparent;
            border-radius: 2px;
            font-size: 14px;
            margin-top:10px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 2px 2px 0px;
        }
        .itembox .img_box{
            position: relative;
            width: 100%;
            height:150px;
        }

        .itembox .img_box img{
            width: 100%;
            height: 100%;
            border-radius: 1px;
        }
        .price_box{
            left: 5px;
            border:1px solid #c9d1d9;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
            background: #000000;
            opacity: 0.8;
            line-height: 20px;
            color: #ffffff;
            top:5px;
            position: absolute;
            width:auto;
            padding-right: 3px;
            padding-left: 3px;
            height: 20px;
        }
        .price{
            color: red;
            font-size: 16px;
        }
        .title_box,.address_box{
            width: 100%;
            margin-bottom: 5px;
        }
        .title{
            margin-left: 5px;
            font-family:SourceHanSansSC;
            font-weight:400;
            font-size:16px;
            color:rgb(16, 16, 16);
            font-style:normal; letter-spacing:0px;
            line-height:24px; text-decoration:none;
        }
        .address{
            margin-left: 5px;
            font-family:SourceHanSansSC;
            font-weight:400; font-size:12px; 
            color:rgba(16, 16, 16, 0.48); font-style:normal;
            letter-spacing:0px; line-height:18px; text-decoration:none;
        }
        .bottom{
            width: 100%;
            position: relative;
            bottom:0;
            text-align: center;
            padding-top:10px;
            padding-bottom: 10px;
            color:#aeb0b2;
            font-family:SourceHanSansSC;
            font-weight:400;
            font-size:14px; color:rgba(16, 16, 16, 0.39);
            font-style:normal; letter-spacing:0px; line-height:21px; text-decoration:none;
        }
    </style>
</head>
<body>
	<!-- 下拉菜单 -->
    <div class="paixu_shaixuan_box">
        <!-- 排序 -->
        <div class="paixu_box">
            <input type="text" name="paixu_word" value="" id='paixu_word' onclick="showpaixuList()"/>
            <div class="flag_ico" onclick="showpaixuList()"></div>
            <!-- 隐藏部分 -->
            <ul id="choosepaixu_box" hidden="true">
            </ul>
        </div> 
        <!-- 筛选 -->
        <div class="shaixuan_box">
            <input type="text" name="shaixuan_word" value="" id='shaixuan_word' onclick="showshaixuanList()"/>
            <div class="flag_ico" onclick="showshaixuanList()"></div>
            <!-- 隐藏部分 -->
            <ul id="chooseshaixun_box" hidden="true">
            </ul>
        </div>
    </div>
    <!-- 空间列表 -->
    <div id="space_box">
        
    </div>
    <div class="bottom">
        <span class="bottom_text" id='bottom_text'></span>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/SHA1.js"></script>
<script type="text/javascript" src="../../script/APICloud-rest.js"></script>
<script type="text/javascript">
    var paixu_words = ["默认排序","价格从低到高","价格从高到低","人数从少到多","人数从多到少"];
    var shaixuan_words = ["筛选","使用日期","使用时间","使用历史","请输入会议人数(人)"];
    var UILoading;
    var flowerid;
    var paixu_word = document.getElementById("paixu_word");
    var shaixuan_word = document.getElementById("shaixuan_word");
    var bottom_text = document.getElementById("bottom_text")
    paixu_word.setAttribute('readonly','readonly');
    shaixuan_word.setAttribute('readonly','readonly');
    paixu_word.setAttribute('value',paixu_words[0]);
    shaixuan_word.setAttribute('value',shaixuan_words[0]);
    var choosepaixu_box = document.getElementById("choosepaixu_box");
    var chooseshaixun_box = document.getElementById("chooseshaixun_box");
    var html_paixu = "";
    var html_listdata = document.getElementById("space_box");
    for(var i=0;i<paixu_words.length;i++){
     html_paixu += "<li class='paixu_word_item' onclick=fnpaixu("+i+")>"+paixu_words[i]+"</li>";
    }
    choosepaixu_box.innerHTML = html_paixu;

    var html_shaixuan = "";
    for(var i=0;i<shaixuan_words.length;i++){
     html_shaixuan += "<li class='shaixuan_word_item' onclick=fnshaixuan("+i+")>"+shaixuan_words[i]+"</li>";
    };
    chooseshaixun_box.innerHTML = html_shaixuan;
    function loadData(){
        UILoading = api.require('UILoading');
        UILoading.flower({
            center: {
                x: api.winWidth/2,
                y: api.winHeight/2
            },
            mask:"rgba(0,0,0,0.1)",
            size: 30,
            fixed: true
            }, function(ret) {
                flowerid = ret.id
            });
        api.ajax({
            url: api.pageParam.name,
            method: 'get',
        },function(ret, err){
            UILoading.closeFlower ({
                id: flowerid
            });
            if (ret) {
                var json_data = ret.data;
                var data_html = "";
                if(json_data.length!=0){
                 for(var i=0;i<json_data.length;i++){
                    data_html+="<div class='itembox' onclick=godetailpage('"+json_data[i]['url']+"')>\
            <div class='img_box'>\
                <img src='"+json_data[i]['pic']+"'/>\
                <span class='price_box'>￥<span class='price'>"+json_data[i]['price']+"</span>/"+json_data[i]['pricetype']+"</span>\
            </div>\
            <div class='title_box'>\
                <span class='title'>"+json_data[i]['title']+"</span>\
            </div>\
            <div class='address_box'>\
                <span class='address'>"+json_data[i]['address']+"</span>\
            </div>\
        </div>"
                }
                 html_listdata.innerHTML = data_html;
                 bottom_text.innerHTML = "没有更多了";
            } else {
                bottom_text.innerHTML = "没有数据！";
            }
        }else{
            alert(err.msg);
            bottom_text.innerHTML = "没有数据！";
        }
        api.refreshHeaderLoadDone();
        });
    };
	apiready = function(){
        loadData();
        api.setRefreshHeaderInfo({
        visible: true,
        loadingImg: '../../image/navtabbar/loading_more.gif',
        bgColor: '#fff',
        textColor: '#cdcdcd',
        textDown: '下拉刷新...',
        textUp: '松开刷新...',
        showTime: true
    }, function(ret, err){
        loadData();
    });
        
    };
    function fnpaixu(index){
        paixu_word.setAttribute('value',paixu_words[index]);
        html_listdata.innerHTML = "";
        loadData();
        choosepaixu_box.setAttribute('hidden','true');
    };
    function fnshaixuan(index){
        shaixuan_word.setAttribute('value',shaixuan_words[index]);
        html_listdata.innerHTML = "";
        loadData();
        chooseshaixun_box.setAttribute('hidden','true');
    };
    function showpaixuList(){
        if(!chooseshaixun_box.getAttribute('hidden')){
            chooseshaixun_box.setAttribute('hidden','true');
        }
        if(choosepaixu_box.getAttribute('hidden')=="true"){
            choosepaixu_box.removeAttribute('hidden');
        }else{
            choosepaixu_box.setAttribute('hidden','true');
        }
    };
    function showshaixuanList(){
        if(!choosepaixu_box.getAttribute('hidden')){
            choosepaixu_box.setAttribute('hidden','true');
        }
        if(chooseshaixun_box.getAttribute('hidden')=="true"){
            chooseshaixun_box.removeAttribute('hidden');
        }else{
            chooseshaixun_box.setAttribute('hidden','true');
        }
    };
    function godetailpage(url){
        var now = Date.now();
        var appKey = SHA1("A6006620792786"+"UZ"+"B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E"+"UZ"+now)+"."+now
        api.ajax({
            url: 'https://d.apicloud.com/mcm/api/file?filter={"where":{"name":"space.json"},"skip":0,"limit":20}',
            method: 'get',
            cache:false,
            headers:{
                 "X-APICloud-APPId": "A6006620792786",
                 "X-APICloud-APPKey": appKey
            }
        },function(ret1, err){
            if (ret1) {
                if(ret1.length!=0){
                    var userloginstatu = api.getPrefs({sync: true,key:'userloginstatu'});
        if(userloginstatu){
            api.openWin({
            name: 'bj_huamaoPage',
            url: 'detailmodule.html',
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                h: api.winHeight
            },
            pageParam: {
                name: url,
                filename:ret1[0].url
            },
            bounces: false,
            bgColor: '#ffffff',
            vScrollBarEnabled: false,
            hScrollBarEnabled: true
        });
        }else{
            api.openWin({
                name: 'login',
                url: '../../html/login.html',
                pageParam:{
                name:url,
                filename:ret1[0].url,
                page_url:'modules/detailmodule.html'
            }
            });
        }
                }else{
                    alert("没数据呀~")
                }
            } else {
                alert(err.msg);
            }
        });
    }
</script>
</html>