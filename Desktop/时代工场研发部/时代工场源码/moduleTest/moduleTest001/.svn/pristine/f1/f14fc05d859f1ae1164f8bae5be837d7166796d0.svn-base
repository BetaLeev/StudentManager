<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>项目发布</title>
    <style>
        body{
            padding: 0px;
            margin: 0px;
            font-family:SourceHanSansSC;
        }
        #movelist_box{
            width:99%;
            height: auto;
            margin:0 auto;

        }
        .move_item{
            width:99%;
            height:200px;
            background-color: rgb(250, 250, 250);
            border-color: transparent;
            border-radius: 2px;
            margin-top:10px;
            padding:2px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 2px 2px 0px;
        }
        .move_top{
            width:98%;
            margin:0 auto;
            height:140px;
        }
        .move_top img{
            width:100%;
            height: 100%;
            object-fit: cover;
        }
        .move_bottom{
            width:100%;
            height:60px;
            /*float: left;*/
        }
        .move_bottom .left{
            float: left;
            position: relative;
            width:80%;
            height:100%;
        }
        .move_bottom .right{
            float: right;
            width:20%;
            height:100%;
        }
        .left_top{
            width: 100%;
            height:40%;
            padding-left: 2px;
            margin-top:2px;
            border-right: 2px solid #DCDCDC;
        }
        .left_top span{
            width:50%;
            font-weight: 400;
            font-size: 14px;
            padding: 0px;
            line-height: 20px;
            font-weight: normal;
            font-style: normal;
        }
        .left_bottom{
            padding-left:2px;
            width:50%;
            height:50%;
        }
        .left_bottom img{
            width: 15px;
            height: 15px;

        }
        .left_bottom span{
            color: #bebbbb;
            font-size: 12px;
        }
        .right_pic{
            width:100%;
            height:40%;
            text-align: center;
        }
        .right_pic img{
            margin-top:2px;
            width:26px;
            height:26px;
        }
        .right_bottom{
            width:100%;
            height:40%;
            text-align: center;
        }
        .right_bottom span{
            font-size: 12px;
            position: relative;
            font-weight:400;
            color:#ff9862;
            font-style:normal;
            letter-spacing:0px; line-height:21px; text-decoration:none;
        }
        .bottom{
            width: 100%;
            position: relative;
            bottom:0;
            text-align: center;
            padding-top:10px;
            padding-bottom: 10px;
            color:#aeb0b2;
            font-family:SourceHanSansSC;
            font-weight:400;
            font-size:14px; color:rgba(16, 16, 16, 0.39);
            font-style:normal; letter-spacing:0px; line-height:21px; text-decoration:none;
        }
    </style>
</head>
<body>
   <div id="movelist_box">
        
   </div>
   <div class="bottom">
        <span class="bottom_text" id='bottom_text'></span>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/SHA1.js"></script>
<script type="text/javascript" src="../../script/APICloud-rest.js"></script>
<script type="text/javascript">
    var html_box = document.getElementById("movelist_box");
    var bottom_text = document.getElementById("bottom_text");
    var UILoading;
    var flowerid;
    function loaddata(){
        UILoading = api.require('UILoading');
        UILoading.flower({
            center: {
                x: api.winWidth/2,
                y: api.winHeight/2
            },
            mask:"rgba(0,0,0,0.1)",
            size: 30,
            fixed: true
            }, function(ret) {
                flowerid = ret.id
            });
        api.ajax({
           url: api.pageParam.name,
           method: 'get',
       },function(ret, err){
            UILoading.closeFlower ({
                id: flowerid
            });
           if( ret ){
            var json_data = ret.data;
            var data_html = "";
            if(json_data.length!=0){
                for(var i=0;i<json_data.length;i++){
                data_html+="<div class='move_item' tapmode onclick=fngodetailpage('"+json_data[i]['url']+"','"+json_data[i]['title']+"')>\
            <div class='move_top'>\
                <img src='"+json_data[i]['pic']+"' />\
            </div>\
            <div class='move_bottom'>\
                <div class='left'>\
                    <div class='left_top'>\
                        <span>"+json_data[i]['title']+"</span>\
                    </div>\
                    <div class='left_bottom'>\
                        <img src='../../image/homepic/address.png'>\
                        <span>"+json_data[i]['address_area']+"</span>\
                    </div>\
                </div>\
                <div class='right'>\
                    <div class='right_pic'>\
                        <img src='../../image/alarm_on.png'>\
                    </div>\
                    <div class='right_bottom'><span>正在进行</span></div>\
                </div>  \
            </div>  \
        </div>"
            }
            html_box.innerHTML = data_html;
            }else{
                alert('没有找到数据！');
                bottom_text.innerHTML = "没有数据呀~"
            }
            
           }else{
            alert(err.msg);
            bottom_text.innerHTML = err.msg
           }
           api.refreshHeaderLoadDone();
       });
    }
    apiready = function(){
       loaddata();
       api.setRefreshHeaderInfo({
        visible: true,
        loadingImg: '../../image/navtabbar/loading_more.gif',
        bgColor: '#fff',
        textColor: '#cdcdcd',
        textDown: '下拉刷新...',
        textUp: '松开刷新...',
        showTime: true
    }, function(ret, err){
        loaddata();
    });
    };
   function fngodetailpage(url,title){
    var now = Date.now();
        var appKey = SHA1("A6006620792786"+"UZ"+"B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E"+"UZ"+now)+"."+now
        api.ajax({
            url: 'https://d.apicloud.com/mcm/api/file?filter={"where":{"name":"project_publish_detail.json"},"skip":0,"limit":20}',
            method: 'get',
            cache:false,
            headers:{
                 "X-APICloud-APPId": "A6006620792786",
                 "X-APICloud-APPKey": appKey
            }
        },function(ret1, err){
            if(ret1){
                if(ret1.length!=0){
                    var userloginstatu = api.getPrefs({sync: true,key:'userloginstatu'});
            if(userloginstatu){
                api.openWin({
                    name: 'detailePage_win',
                    url: 'detailmove.html',
                    pageParam: {
                        name: url,
                        title:title,
                        filename:ret1[0].url

                    },
                    bounces: true,
                    bgColor: '#ffffff',
                    vScrollBarEnabled: true,
                    hScrollBarEnabled: true
                });
            }else{
                api.openWin({
                    name: 'login',
                    url: '../../html/login.html',
                    pageParam:{
                    name:url,
                    title:title,
                    filename:ret1[0].url,
                    page_url:'modules/detailmove.html'
                }
                });
                
            }
                    }else{

                    }
                }else{
                    alert(err.msg)
                }

            });
   };
</script>
</html>