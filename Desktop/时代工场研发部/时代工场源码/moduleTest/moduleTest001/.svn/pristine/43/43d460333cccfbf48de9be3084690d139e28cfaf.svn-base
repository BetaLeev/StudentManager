<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>我要发布空间module</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        body{
            margin: 0;
            padding: 0;
            height: auto;
        }
        .form{
            width:99%;
            padding: 0;
            margin: 0;
            height:20px;
            margin-top:30%;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }
        .line{
            width:100%;
            /*margin:0 auto;*/
            height:50px;
            text-align: center;
        }
        .line input{
            width:70%;
            height: 26px;
            -webkit-tap-highlight-color: rgba(0,0,0,0);outline:none;
            border:1px solid #c9d1d9;
            font-size: 14px;
            border-left: none;
            border-radius: 3px;
            padding-left:5px;
        }
        .fgx{
            width:100%;
            height: 6px;
            margin-top: 5px;
            background-color:#f7f7f8;
            white-space: pre-wrap;
        }
        .middle_box{
            width:100%;
            height: auto;
            text-align: center;
            margin-bottom: 10px;

        }
        .middle_box span{
            font-family:SourceHanSansSC; font-weight:400;
            font-size:16px; color:rgb(16, 16, 16);
            font-style:normal;
            letter-spacing:0px; line-height:27px; text-decoration:none;
        }
        .btn_group{
            width:100%;
            height:40px;
            position: absolute;
            bottom:0px;
        }
        .btn_group button{
            width: 50%;
            float: left;
            height: 100%;
            text-align: center;
            border-radius: 5px;
        }
        #cancel{
            border-top:1px solid #c9d1d9;
            color:#125E88;
        }
        #commit{
            background-color:#125E88;
            color:white;
        }
    </style>
</head>
<body>
    <div class="form">
            <span>请输入您发布空间的具体信息</span>
        </div>
        <div class="line">
            <label class="lb_name">国家:</label>
            <input id="nation" type="text" name="nation" placeholder="请输入您要发布空间所在的国家" value=""></input>
        </div>
        <div class="line">
            <label class="lb_name">城市:</label>
            <input id="city" type="text" name="city" placeholder="请输入您要发布空间所在的城市" value=""></input>
        </div>
        <div class="line">
            <label class="lb_tel">区位:</label>
            <input id="classify" type="text" name="classify" placeholder="请输入您要发布空间所在的区位" value=""></input>
        </div>
        <div class="line">
            <label class="lb_tel">面积:</label>
            <input id="area" type="text" name="area" placeholder="请输入您要发布空间所在的面积(单位㎡)" value=""></input>
        </div>
    </div>
    <div class="btn_group">
        <button id='cancel' tapmode onclick="api.closeWin()">取消</button>
        <button id="commit" tapmode onclick="fnCommit()">提交</button>
    </div>  
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/SHA1.js"></script>
<script type="text/javascript" src="../../script/APICloud-rest.js"></script>
<script type="text/javascript">
    var Obj_customer_nation = document.getElementById("nation");
    var Obj_city = document.getElementById("city");
    var Obj_classify = document.getElementById("classify");
    var Obj_area = document.getElementById("area");
    var UILoading;
    var flowerid;
    apiready = function(){
        UILoading = api.require('UILoading');
    };
    function fnCommit(){
        var publish_phone = api.getPrefs({sync: true,key:'user_phone'});
        var nation = Obj_customer_nation.value.replace(/^\s*|\s*$/g,'');
        var city = Obj_city.value.replace(/^\s*|\s*$/g,'');
        var classify = Obj_classify.value.replace(/^\s*|\s*$/g,'');
        var area = Obj_area.value.replace(/^\s*|\s*$/g,'');
        if(publish_phone){
            if(nation.length!=0&&city.length!=0&&classify.length!=0&&area.length!=0){
            postCustomer(nation,city,classify,area,publish_phone);
        }else{
            api.toast({
                msg: '输入不能为空',
                duration: 2000,
                location: 'bottom'
            });
        }
        }else{
            api.openWin({
                name: 'login',
                url: '../../html/login.html',
                pageParam:{
                page_url:'../../html/recommend_house.html'
            }
            });
        }
        
        
    };
    function postCustomer(nation,city,classify,area,publish_phone){
        UILoading.flower({
            center: {
                x: api.winWidth/2,
                y: api.winHeight/2
            },
            mask:"rgba(0,0,0,0.1)",
            size: 30,
            fixed: true
            }, function(ret) {
                flowerid = ret.id
            });
        var now = Date.now();
        var appKey = SHA1("A6006620792786"+"UZ"+"B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E"+"UZ"+now)+"."+now;
        api.ajax({
            url: 'https://www.apicloud.com/mcm/api/house_infor',
            method: 'POST',
            headers:{
            "X-APICloud-AppId": "A6006620792786",
            "X-APICloud-AppKey":appKey
            },
            data:{
                values:{
                    nation:nation,
                    city:city,
                    classify:classify,
                    area:area,
                    phone:publish_phone
                    }
            }
        },
        function(ret, err){
            UILoading.closeFlower ({
                    id: flowerid
                });
            if (ret) {
                api.toast({
                    msg: '提交成功',
                    duration: 2000,
                    location: 'bottom'
                });
                Obj_customer_nation.value = "";
                Obj_city.value.value = "";
                Obj_classify.value = "";
                Obj_area.value = "";

            } else {
                alert(err.msg);
            }

        }
        );
    };
</script>
</html>