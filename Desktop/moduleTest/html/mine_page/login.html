<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>登录</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../aui-20170109-v2.1/css/aui.css" />
    <link rel="stylesheet" href="../../css/common.js">
    <style>
        body {
            text-align: center;
        }

        header {
            padding-top: 25px !important;
            border-bottom: 1px solid #4b4b4b;
            background-color: #f0f0f0;
        }

        header * {
            color: #4b4b4b !important;
        }

        .aui-bar,
        .aui-bar span {
            color: #4b4b4b !important;
        }

        .top {
            width: 100%;
            margin-top: 30px;
        }

        .row {
            box-sizing: border-box;
            width: auto;
            height: 70px;
            margin-left: 45px;
            margin-right: 45px;
            padding-top: 30px;
            border-bottom: 1px solid #f1f1f1;
        }

        .input {
            width: 100%;
            height: 20px;
            line-height: 20px;
            border: none;
            outline: none;
            font-size: 16px;
            color: #b5b5b6;
            /*text-align: center;*/
        }

        .wjmm {
            width: 100%;
            float: right;
            margin-top: 10px;
            margin-right: 80px;
            font-size: 14px;
            text-align: right;
            color: #707070;
        }

        .login-btn {
            position: relative;
            width: 40%;
            height: 50px;
            outline: none;
            border: none;
            background-color: #FED765;
            color: #4b4b4b;
            font-size: 1rem;
            line-height: 50px;
            margin-top: 30px;
            text-align: center;
            border-radius: 8px;
        }

        .qtdl {
            width: 100%;
            /*height: 100px;*/
            position: absolute;
            bottom: 0;
            /*margin-bottom: 0px;*/
        }

        .wz {
            width: 99%;
            margin-top: 160px;
            text-align: center;
        }

        .wz .line {
            display: inline-block;
            width: 30%;
            border-top: 1px solid #ccc;
        }

        .wz .txt {
            color: #686868;
            vertical-align: -4px;
        }

        #image {
            margin-top: -10px;
            width: 100%;
            height: 80px;
            display: flex;
            justify-content: space-around;
        }

        #image .weixin {
            position: relative;
            margin-top: 16px;
            box-sizing: border-box;
            width: 50px;
            height: 50px;
            background-repeat: no-repeat;
            background-image: url(../../image/wechat.png);
            background-size: 100% 100%;
            background-position: center center;
        }

        #image .weibo {
            position: relative;
            margin-top: 14px;
            box-sizing: border-box;
            width:50px;
            height: 50px;
            background-repeat: no-repeat;
            background-image: url(../../image/weibo.png);
            background-size: 100% 100%;
            background-position: center center;
        }

        #image .youxiang {
            position: relative;
            margin-top: 12px;
            /*margin-left: 1%;*/
            box-sizing: border-box;
            width: 50px;
            height: 50px;
            background-repeat: no-repeat;
            background-image: url(../../image/email.png);
            background-size: 100% 100%;
            background-position: center center;
        }

        #wrap {
            width: 100%;
            height: 30px;
            margin-top: -14px;
            margin-left: 0px;
            display: flex;
            justify-content: space-around;
        }

        #wrap #weixin {
            position: relative;
            box-sizing: border-box;
            margin-left: -3%;
            width: 20%;
            height: 50px;
            text-align: center;
        }

        #wrap #weibo {
            position: relative;
            margin-left: 3%;
            width: 20%;
            height: 15px;
            text-align: center;
        }

        #wrap #youxiang {
            position: relative;
            margin-left: 4%;
            width: 20%;
            height: 50px;
            text-align: center;
        }

        .highlight {
            opacity: 0.7;
        }
    </style>
    <script src="https://cdn.bootcss.com/sweetalert/2.1.2/sweetalert.min.js"></script>

</head>

<body>
    <header class="aui-bar aui-bar-nav aui-bar-light">
        <div class="aui-pull-left aui-btn">
            <span class="aui-iconfont aui-icon-left" onclick="closeCurrentWin()"></span>
        </div>
        <div class="aui-title">会员登录</div>
        <div class="aui-pull-right aui-btn">
            <span onclick="goNextWin('./register.html')">注册</span>
        </div>
    </header>
    <div class="top">
        <div class="row">
            <input id="phonenumber" class="input" type="text" placeholder="请输入您的手机号/邮箱">
        </div>
        <div class="row">
            <input id="password" class="input" type="password" placeholder="请输入您的账户密码">
        </div>
        <div class="wjmm" tapmode onclick="fnfortpassword()">忘记密码?</div>
    </div>
    <button class='btn-normal login-btn' onclick="goNextWin('./login_success.html')">登陆</button>
    <div class="qtdl">
        <div class="wz">
            <span class="line"></span>
            <span class="txt">其它登录</span>
            <span class="line"></span>
        </div>
        <div id="image">
            <span class="weixin" onclick="loginByWechat()">
            </span>
            <span class="weibo" onclick="loginByWeibo()">
            </span>
            <span class="youxiang">
            </span>
        </div>
        <!-- <div id="wrap">
            <span id="weixin">微信</span>
            <span id="weibo">微博</span>
            <span id="youxiang">邮箱</span>
        </div> -->

    </div>
</body>
<script src="../../script/api.js" charset="utf-8"></script>
<script src="../../script/login.js" charset="utf-8"></script>
<script src="../../script/common.js" charset="utf-8"></script>

<script type="text/javascript">
    apiready = function() {};
</script>
<script type="text/javascript">
    // //微信登陆模块
    function loginByWechat() {
        var wxPlus = api.require('wxPlus');
        wxPlus.auth({
            apiKey: 'wxf476d7072eeddaae'
        }, function(ret, err) {
            if (ret.status) {
                wxPlus.getToken({
                    apiKey: 'wxf476d7072eeddaae',
                    apiSecret: '749f4d30f5f112db7db6aafbaf03eb05',
                    code: ret.code
                }, function(ret, err) {
                    if (ret.status) {
                        wxPlus.getUserInfo({
                            accessToken: ret.accessToken,
                            openId: ret.openId
                        }, function(ret, err) {
                            if (ret.status) {
                             $api.setStorage('openId', ret.status.openid);
                             $api.getStorage('openId');

                                var model = api.require("model");
                                model.config({
                                    appKey: 'B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E',
                                })
                                model.insert({
                                    class: 'era_user',
                                    value: {
                                        name: ret.nickname,
                                        avatar: ret.headimgurl,
                                        identifer: 'wechat',
                                        openId: ret.openid
                                    }
                                }, function(ret, err) {
                                    if (err) {
                                        console.log(err)
                                        swal("Oops", "微信登陆失败", "error")
                                    } else if (ret) {
                                        swal("成功", "授权登录成功", "success");
                                        api.closeToWin({
                                            name: '../home_page/index.html'
                                        });

                                        // goNextWin('./index.html')
                                    }
                                })
                                $api.setStorage('userName', ret.nickname);
                                $api.setStorage('openid', ret.openid);
                                $api.setStorage('userAvatar', ret.headimgurl);
                            } else {
                                swal("Oops", "微信登陆失败", "error")
                            }
                        });
                    } else {
                        swal("Oops", "微信登陆失败", "error")
                    }
                });
            } else {
                swal("Oops", "微信登陆失败", "error")
            }
        });
    }
</script>


<script type="text/javascript">
    function loginByWeibo() {
        var weiboPlus = api.require('weiboPlus');
        weiboPlus.auth(function(ret, err) {
            if (ret.status) {
                alert(JSON.stringify(ret));
                var token = ret.accessToken;
                weiboPlus.getUserInfo({
                    token: token,
                    userId: ''
                }, function(ret, err) {
                    if (ret.status) {
                        api.alert(JSON.stringify(ret))
                            // $api.setStorage('userName', ret.status.user);

                    }
                });
            }
        });
        //   weiboPlus.auth(function(ret, err) {
        //       if (ret.status) {
        //           alert(JSON.stringify(ret));
        //   //         weiboPlus.getUserInfo({
        //   //             token: ret.token,
        //   //             userId: ret.userId
        //   //         }, function(ret, err) {
        //   //             if (ret.status) {
        //   //                 // $api.setStorage('userName', ret.nickname);
        //   //                 // $api.setStorage('userAvatar', ret.headimgurl);
        //   //                 // alert($api.getStorage('userAvatar'));
        //   //                 alert(JSON.stringify(ret))
        //   //                 goNextWin('./login_success.html')
        //   //                 alert(JSON.stringify(ret.userInfo));
        //   //             }
        //   //         });
        // }else{
        //       alert(JSON.stringify(ret));
        // }
        //   });
    }
</script>


</html>
