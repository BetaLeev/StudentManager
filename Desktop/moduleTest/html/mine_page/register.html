<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>注册</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../aui-20170109-v2.1/css/aui.css" />
    <link rel="stylesheet" href="../../css/common.css">
    <style>
        body {
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #fff;
        }


        .aui-bar,
        .aui-bar span {
            color: #4b4b4b !important;
        }

        .jieshaoyu {
            width: 100%;
            height: 30px;
            margin-left: -120px;
            margin-top: 40px;
            font-size: 24px;
        }

        .jieshaoyu1 {
            width: 100%;
            height: 30px;
            margin-left: -75px;
            font-size: 24px;
        }

        .row {
            box-sizing: border-box;
            width: auto;
            height: 70px;
            margin-left: 60px;
            margin-right: 60px;
            padding-top: 30px;
            border-bottom: 1px solid #f1f1f1;
        }

        .input {
            width: auto;
            height: 30px;
            line-height: 30px;
            outline: none;
            font-size: 17px;
            color: #cbcbcb;
            border-bottom: 1px solid #4b4b4b;
        }

        .coll {
            width: auto;
            height: 70px;
        }

        .btnyzm {
            width: 27%;
            height: 30px;
            margin-left: 235px;
            margin-top: -40px;
            background-color: #fff;
            color: #707070;
            font-size: 15px;
            line-height: 30px;
            text-align: center;
            border-radius: 20px;
            float: left;
            border: 1px solid #cbcbcb;
        }

        .iszcxy {
            width: 100%;
            height: 70px;
            /*float: center;*/
            text-align: center;
        }

        .isxz {
            font-size: 20px;
            float: left;
            margin-left: 32%;
            margin-top: 10px;
            color: #707070;
            margin-right: 5px;
        }

        .isxz input {
            height: 30px;
            width: 30px;
        }

        .zcxy {
            font-size: 14px;
            width: auto;
            line-height: 57px;
            text-align: left;
            color: #707070;
            margin-left: 12px;
            margin-top: 50px;
        }

        .btn {
            width: 30%;
            height: 40px;
            margin-left: 35%;
            margin-right: 40%;
            margin-top: 60px;
            background-color: #FED765;
            color: #707070;
            font-size: 19px;
            line-height: 40px;
            text-align: center;
            border-radius: 8px;
        }

        .highlight {
            opacity: 0.7;
        }
    </style>
</head>

<body>
    <header class="aui-bar aui-bar-nav aui-bar-light">
        <div class="aui-pull-left aui-btn">
            <span class="aui-iconfont aui-icon-left" onclick="closeCurrentWin()"></span>
        </div>
        <div class="aui-title">会员注册</div>
        <div class="aui-pull-right aui-btn">
        </div>
    </header>
    <div class="jieshaoyu">欢迎</div>
    <div class="jieshaoyu1">来到时代工场</div>
    <div class="row">
        <input id="username" class="input" type="text" placeholder="请输入您的姓名">
    </div>
    <div class="coll">
        <div class="row">
            <input id="phonenumber" class="input" type="text" placeholder="请输入您的手机号">
        </div>
        <div id='code' class="btnyzm" tapmode onclick="sendSmsCode()">获取验证码</div>
    </div>
    <div class="row">
        <input id="yanzhengma" class="input" type="text" placeholder="请输入您的验证码">
    </div>
    <div class="row">
        <input id="password" class="input" type="password" placeholder="请输入您的密码">
    </div>
    <div class="row">
        <input id="password" class="input" type="password" placeholder="请确认您的密码">
    </div>
    <div class="iszcxy">
        <div class="isxz"><input type="checkbox" name='read' value='1'></div>
        <div class="zcxy">用户注册协议、服务条款</div>
    </div>
    <div class="btn" onclick="">注册</div>

    <div id="cont">

       </div>

    <script id="contentTemplate" type="text/x-dot-template">
    {{~it.dataArr:value:index}}
         <div class="content">
             <div class="use">
                 <img class="userImg" src="" alt="">
                 <div class="userName">{{= value.userName}}</div>
             </div>
             <div class="userArt">{{= value.userArt}}</div>
             <div class="artDate">
                 {{= value.artDate}}
             </div>
         </div>
         {{~}}
    </script>

</body>

<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/SHA1.js"></script>
<script type="text/javascript" src="../../script/APICloud-rest.js"></script>
<script src="../../doT-master/doT.min.js" charset="utf-8"></script>
<script type="text/javascript">
var data = {
       dataArr: [{
           userName: "Jack",
           userArt: "1、之前要实现横列的web布局，通常就是float或者display：inline-block; 但是都不能做到真正的流体布 局。",
           artDate: "2017-12-12"
       },]}
var conttemp = doT.template(document.getElementById('contentTemplate').innerHTML);  //声明模板
document.getElementById('cont').innerHTML = conttemp(data);

</script>
<script src="../../script/common.js" charset="utf-8"></script>

<script type="text/javascript">
    function ramdNum() {
        var arr = [];
        while (arr.length < 4) {
            var num = parseInt(Math.random() * 10);
            if (arr.indexOf(num) == -1) {
                arr.push(num);
            }
        }
        return arr.join('')
    }


    function sendSmsCode() {
        var number = ramdNum();
        var code = document.getElementById('code');
        var time = 60;

        code.innerHTML = time;
        var smsVerification = api.require('smsVerification');
        smsVerification.sendMessage({
            softVersion: '2014-06-30',
            accountSid: '617ceead33fc69fe9053e9288c23b732',
            accountToken: '592fe5d33083f5836298cc1f9ee3daa9',
            body: {
                appId: '0c5007d1d24c4272b9a92a6a2cc57b95',
                templateId: 1,
                phoneNumber:'15033299606',
                // phoneNumber: '15732613845',
                param: number
            }
        }, function(ret) {
            alert(JSON.stringify(ret));
        });
        // api.ajax({
        //     url: 'https://open.ucpaas.com/ol/sms/sendsms',
        //     dataType:'json',
        //     returnAll:false,
        //     method: 'post',
        //     data: {
        //         "sid": "617ceead33fc69fe9053e9288c23b732",
        //         "token": "592fe5d33083f5836298cc1f9ee3daa9",
        //         "appid": "0c5007d1d24c4272b9a92a6a2cc57b95",
        //         "templateid": "1",
        //         "param": number,
        //         "mobile": "15033299606",
        //         "uid": "2d92c6132139467b989d087c84a365d8"
        //     }
        // }, function(ret, err) {
        //     if (ret) {
        //         alert(JSON.stringify(ret));
        //     } else {
        //         alert(JSON.stringify(err));
        //     }
        // });
        alert('验证码已发送')
    }
</script>
<script type="text/javascript">
  var it = {"name":"Jake","age":31}
</script>
<script type="text/javascript">
    // 设置成手机号登录的形式，11位，密码设置成6-20位，如果不成功请重新输入
    function fncheckinput(username, phonenumber, pwd) {
        if (pwd.length < 6 || pwd.length > 20 || username.length == 0) {
            return false;
        } else if (phonenumber.length != 11 || !(/^1[3456789]\d{9}$/).test(phonenumber)) {
            // alert("手机号输入格式不正确");
            return false;
        } else {
            return true;
        }
    }
    // 。
    function fnRegister() {
        var vusername = $api.val($api.byId("username")).replace(/^\s*|\s*$/g, '');
        var vphonenumber = $api.val($api.byId("phonenumber")).replace(/^\s*|\s*$/g, '');
        var vpassword = $api.val($api.byId("password")).replace(/^\s*|\s*$/g, '');
        var flag_input = fncheckinput(vusername, vphonenumber, vpassword);
        if (flag_input) {
            var now = Date.now();
            var appKey = SHA1("A6006620792786" + "UZ" + "B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E" + "UZ" + now) + "." + now
            api.ajax({
                    url: 'https://www.apicloud.com/mcm/api/user',
                    method: 'post',
                    headers: {
                        "X-APICloud-APPId": "A6006620792786",
                        "X-APICloud-APPKey": appKey
                    },
                    data: {
                        values: {
                            username: vphonenumber,
                            nickname: vusername,
                            password: vpassword
                        }
                    }
                },
                function(ret, err) {
                    if (ret && ret.id) {
                        api.toast({
                            msg: '注册成功！自动登录',
                            duration: 2000,
                            location: 'middle'
                        });
                        api.setPrefs({
                            key: 'userloginstatu',
                            value: true
                        });
                        api.setPrefs({
                            key: 'user_name',
                            value: vusername
                        });
                        api.setPrefs({
                            key: 'user_phone',
                            value: vphonenumber
                        });
                        if (!api.getPrefs({
                                sync: true,
                                key: 'bind_flag'
                            })) {
                            var push = api.require('push');
                            push.bind({
                                userName: vphonenumber,
                                userId: vphonenumber
                            }, function(ret, err) {
                                api.setPrefs({
                                    key: 'bind_flag',
                                    value: 'true'
                                });
                            });
                        }
                        if (api.pageParam.filename) {
                            api.closeWin({
                                name: api.winName
                            });
                            if (api.pageParam.title) {
                                api.openWin({
                                    name: 'detailPage',
                                    url: api.pageParam.page_url,
                                    pageParam: {
                                        name: api.pageParam.name,
                                        title: api.pageParam.title,
                                        filename: api.pageParam.filename
                                    }
                                });
                            } else {
                                api.openWin({
                                    name: 'detailPage',
                                    url: api.pageParam.page_url,
                                    pageParam: {
                                        name: api.pageParam.name,
                                        filename: api.pageParam.filename
                                    }
                                });
                            }
                        } else {
                            api.execScript({
                                name: 'root',
                                frameName: 'frame_my',
                                script: "change_phone_login('" + vphonenumber + "')"
                            });

                            api.closeWin({
                                name: api.winName
                            });
                        }
                    } else {
                        alert("注册失败！");
                    }

                }
            );
        } else {
            alert("注册信息格式不正确，请确认格式正确后再注册");
        }

    }
</script>

</html>
