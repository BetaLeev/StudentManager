<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>时代推荐module</title>
    <style>
        body{
            padding: 0px;
            margin: 0px;
        }
        .top{
            background-color: rgb(250, 250, 250);
            border-color: transparent;
            border-radius: 2px;
            font-size: 14px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 2px 2px 0px;
            width:100%;
            height:30px;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: -webkit-box;
            display: flex;
            justify-content: space-around;
            flex-direction: row;
            justify-content: space-around;
            -webkit-box-pack:center;
        }
        .top span{
            margin-left: 5px;
            line-height: 30px;
            font-family:SourceHanSansSC;
            font-weight:400;
            font-style:normal;
            letter-spacing:0px; text-decoration:none;
        }
        .span_left{
            color:rgb(16, 16, 16);
            font-size:16px;
        }
        .top img{
            margin-top:5px;
        }
        .span_right{
            color:rgba(16, 16, 16, 0.23);
            font-size: 16px;
        }
        .span_right text{
            font-size: 12px;
        }
        /*驿站列表css*/
        #stageBox{
                width: 100%;
                height: auto;
                display: block;
                position: relative;
                z-index: 9999;
                top:5px;
        }
        .stageItem{
            display: -webkit-flex;
            display: -ms-flexbox;
            display: -webkit-box;
            display: flex;
            width:100%;
            height: 101.942px;
            justify-content: space-between;
            flex-direction: row;
            justify-content: space-between;
            -webkit-box-pack:justify;
            font-size: 14px;
            margin-top:10px;
            background-color: rgb(250, 250, 250);
            border-color: transparent;
            border-radius: 2px;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 2px 2px 0px;
        }
        .stageItem img{
            width:44%;
            height: 85px;
            display: block;
            border-radius: inherit;
            transition: inherit;
            margin-left: 5px;
            border: 1px solid black;
        }
        .stageItem .right{
            width:50%;
            height: 85px;
            display: block;
            margin-left: 5px;
            margin-right: 5px;
        }
        .stageItemTitle{
            height: auto;
            font-size: 14px;
            text-align: justify;
            line-height: 20px;
            font-weight: normal;
            font-style: normal;
            color: #101010;
            margin:0;
            width:100%;
            overflow: hidden;
            text-overflow:ellipsis;
            white-space: nowrap;
        }
        .peizhi{
            color: rgba(16, 16, 16, 0.65);
            margin-top:0;
        }
        .price{
            color: #125e88;
        }
        .youshi,.price{
            margin-top:2px;
        }
        .peizhi,.youshi,.price{
            font-size: 12px;
            
        }
        .stageItem .right .stageItemBottom {
            height: auto;
            width:auto;
            bottom: -10px;
        }
        .stageItem .right .stageItemBottom .zixunType{
            color: rgb(255, 152, 0);
            font-size: 12px;
            line-height: 17px;
            font-weight: normal;
            font-style: normal;
            margin-right: 10px;
        }
        .stageItem .right .stageItemBottom .publishTime{color: rgba(16, 16, 16, 0.82);
        font-size: 14px;
        line-height: 20px;
        font-weight: normal;
        font-style: normal;
        }
        .foot{
            width:100%;
            height:24px;
            text-align: center;
            position: relative;
            top:50px;
            
        }
        .foot span{
            color: rgba(16, 16, 16, 0.39);
            font-family: SourceHanSansSC;
            font-weight: 400;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="top">
        <img src="../../image/map_marker_red.png" style="width:15px;height:15px;" />
        <span class="span_left">价格不限、人数不限、舒适空间</span>
        <span class="span_right">|&nbsp;<text>修改</text></span>
    </div>
    <!-- 驿站列表 -->
    <div id="stageBox">
            
            
    </div>
    <!-- 底部 -->
    <div class="foot">
        <span id="foot_text"></span>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/SHA1.js"></script>
<script type="text/javascript" src="../../script/APICloud-rest.js"></script>
<script type="text/javascript">
    var html_listdata = document.getElementById("stageBox");
    var foot_text = document.getElementById("foot_text");
    var UILoading;
    var flowerid;
    function loaddata(){
        UILoading = api.require('UILoading');
        UILoading.flower({
            center: {
                x: api.winWidth/2,
                y: api.winHeight/2
            },
            mask:"rgba(0,0,0,0.1)",
            size: 30,
            fixed: true
            }, function(ret) {
                flowerid = ret.id
            });
        api.ajax({
             url: api.pageParam.name,
             method: 'get',
         }, function(ret, err){
            UILoading.closeFlower ({
                id: flowerid
            });
            if( ret ){
                 var json_data = ret.data;
                 var data_html = "";
                 if(json_data.length!=0){
                    for(var i=0;i<json_data.length;i++){
                    data_html+="<div class='stageItem' tapmode onclick=goStagedetailPage('"+json_data[i]['url']+"')>\
                    <img src='"+json_data[i]['pic']+"'/>\
                <div class='right'>\
                    <p class='stageItemTitle'>"+json_data[i]['title']+"</p>\
                    <p class='peizhi'>"+json_data[i]['peizhi']+"</p>\
                    <p class='youshi'>"+json_data[i]['youshi']+"</p>\
                    <p class='price'>"+json_data[i]['price']+"</p>\
                </div>\
                </div>"
                }
                 html_listdata.innerHTML = data_html;
                 foot_text.innerHTML = "没有更多了"
                 }else{
                    foot_text.innerHTML = "没有找到数据"
                 }
                 
            }else{
                alert(err.msg);
                foot_text.innerHTML = "没有找到数据"
            }
            api.refreshHeaderLoadDone();
        });
    }
    apiready = function(){
        loaddata();
        api.setRefreshHeaderInfo({
        visible: true,
        loadingImg: '../../image/navtabbar/loading_more.gif',
        bgColor: '#fff',
        textColor: '#cdcdcd',
        textDown: '下拉刷新...',
        textUp: '松开刷新...',
        showTime: true
    }, function(ret, err){
        loaddata();
    });
    };
    function goStagedetailPage(address){
        var now = Date.now();
        var appKey = SHA1("A6006620792786"+"UZ"+"B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E"+"UZ"+now)+"."+now
        api.ajax({
            url: 'https://d.apicloud.com/mcm/api/file?filter={"where":{"name":"all_stage.json"},"skip":0,"limit":20}',
            method: 'get',
            cache:false,
            headers:{
                 "X-APICloud-APPId": "A6006620792786",
                 "X-APICloud-APPKey": appKey
            }
        },function(ret1, err){
            if(ret1){
                if(ret1.length!=0){
                    var userloginstatu = api.getPrefs({sync: true,key:'userloginstatu'});
                    var userloginstatu = api.getPrefs({sync: true,key:'userloginstatu'});
                    if(userloginstatu){
                        api.openWin({
                        name: 'detailPage',
                        url: 'detailmodule.html',
                        rect: {
                            x: 0,
                            y: 45,
                            w: api.winWidth,
                            h: api.winHeight
                        },
                        pageParam: {
                            name: address,
                            filename:ret1[0].url,
                        },
                        bounces: true,
                        bgColor: '#ffffff',
                        vScrollBarEnabled: true,
                        hScrollBarEnabled: true,
                    });
                    }else{
                        api.openWin({
                            name: 'login',
                            url: '../../html/login.html',
                            pageParam:{
                            name:address,
                            filename:ret1[0].url,
                            page_url:'modules/detailmodule.html'
                        }
                        });
                        
                    }
                }else{

                }
            }else{
                alert(err.msg)
            }

        });
    };
    function showpaixuList(){
        if(!chooseshaixun_box.getAttribute('hidden')){
            chooseshaixun_box.setAttribute('hidden','true');
        }
        if(choosepaixu_box.getAttribute('hidden')=="true"){
            choosepaixu_box.removeAttribute('hidden');
        }else{
            choosepaixu_box.setAttribute('hidden','true');
        }
    };
    function showshaixuanList(){
        if(!choosepaixu_box.getAttribute('hidden')){
            choosepaixu_box.setAttribute('hidden','true');
        }
        if(chooseshaixun_box.getAttribute('hidden')=="true"){
            chooseshaixun_box.removeAttribute('hidden');
        }else{
            chooseshaixun_box.setAttribute('hidden','true');
        }
    };
</script>
</html>