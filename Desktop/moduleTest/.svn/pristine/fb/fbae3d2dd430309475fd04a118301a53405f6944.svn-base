<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>recommendedprized_Frame</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
    html,
    body,html{
        height: 100%;
        margin:0;
        padding:0;
        background-color: #fff;
    }
    .logo {
        position: relative;
        height: 200px;
        width: 100%;
        background-image: url(https://org.modao.cc/uploads4/images/3046/30466674/v2_pm4jxm.jpg);
        background-repeat: no-repeat;
        background-size: auto 90%;
        background-position: center center;
    }
    .logol {
        position: relative;
        height: 200px;
        width: 100%;
        background-image: url(../image/wx_share.png);
        background-repeat: no-repeat;
        background-size: auto 50px;
        background-position: center center;
    }
    
    .version {
        position: relative;
        height: 60px;
        color: #444;
        width: 80%;
        font-size: 14px;
    }
    
    .version .center {
    	position: relative;
        width: auto;
        height: 50px;
        margin-top: 30px;
        left: 22px;
        color: #444;
        font-size: 20px;
        line-height: 50px;
    }
    section {
        height: auto;
        width: 100%;
    }
    
    section .option {
        position: relative;
        display: -webkit-box;
        display: -webkit-flex;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-flex-flow: row;
        flex-flow: row;
        box-sizing: border-box;
        width: 100%;
        height: 60px;
        padding-left: 16px;
        padding-right: 16px;
        margin-bottom: 1px;
        background-color: #fff;
    }
    section .option .name {
        width: auto;
        margin-left: 22px;
        line-height: 60px;
        margin-top: 0px;
    }
    
    section .option .input {
        -webkit-box-flex: 10;
        -webkit-flex: 10;
        flex: 1;
        height: 60px;
        box-sizing: border-box;
        padding-top: 22px;
        margin-left: 10px;
    }
    
    section .option .input input {
        font-size: 14px;
        width: 80%;
        height: 20px;
        line-height: 14px;
        vertical-align: top;
        border: none;
        border:1px solid #cdcdcd;
        border-radius: 3px;
        outline:none;
        position:relative;
        top:-2px;
    }
    .button {
        width: auto;
        height: 50px;
        margin-left: 32px;
        margin-right: 32px;
        margin-top: 0px;
        background-color: #125E88;
        line-height: 50px;
        color: #fff;
        font-size: 20px;
        text-align: center;
        border-radius: 8px;
    }
    
    .highlight {
        opacity: 0.7;
    }
    
    </style>
</head>

<body>
    <section>
        <div class="logo"></div>
        <div class="version">
            <div class="center">把好友推荐给时代工场</div>
        </div>
        <div class="option">
            <div class="name">姓&nbsp;&nbsp;&nbsp;名:</div>
            <div class="input">
                <input id="name" type="text" placeholder="请输入您推荐人的姓名">
            </div>
        </div>
        <div class="option">
            <div class="name">手机号:</div>
            <div class="input">
                <input id="phone" type="text" placeholder="请输入您推荐人的手机号码">
            </div>
        </div>
        <div class="version">
            <div class="center">提供详细信息便于快速匹配房源</div>
        </div>
        <div class="button" tapmode onclick="fnCommit();">立即推荐</div> 
        <!-- 添加一个分割线效果 -->
       <!--  <HR align=center width=80% color=#ffb SIZE=2> -->
        <!-- <div class="version">
            <div class="center">把时代工场推荐给好友</div>
        </div>
        <div class="button" tapmode onclick="fnwxsharefriends();">微信分享好友</div> 
        <div class="logol"></div> -->
    </section>
</body>

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/SHA1.js"></script>
<script type="text/javascript" src="../script/APICloud-rest.js"></script>
<script type="text/javascript">
    var Obj_customer_name = document.getElementById("name");
    var Obj_customer_tel = document.getElementById("phone");
    var UILoading;
    var flowerid;
    apiready = function(){
        UILoading = api.require('UILoading');
    };
    function fnCommit(){
        var customer_name = Obj_customer_name.value.replace(/^\s*|\s*$/g,'');
        var customer_tel = Obj_customer_tel.value.replace(/^\s*|\s*$/g,'');
        var references_phone = api.getPrefs({sync: true,key:'user_phone'});
        if(references_phone){
            if(customer_name.length!=0&&customer_tel.length!=0){
                if(customer_tel.length!=11||!(/^1[3456789]\d{9}$/).test(customer_tel)){
                    alert("输入的手机号格式不正确")
                }else{
                    postCustomer(customer_name,customer_tel,references_phone);
                }
            }else{
                alert("输入不能为空")
            }
        }else{
            api.openWin({
                name: 'login',
                url: '../../html/login.html',
                pageParam:{
                page_url:'../../html/jiankehu.html'
            }
            });
        }
    };
    function postCustomer(customername,customer_tel,references_phone){
        UILoading.flower({
            center: {
                x: api.winWidth/2,
                y: api.winHeight/2
            },
            mask:"rgba(0,0,0,0.1)",
            size: 30,
            fixed: true
            }, function(ret) {
                flowerid = ret.id
            });
        var now = Date.now();
        var appKey = SHA1("A6006620792786"+"UZ"+"B4BE1D4A-18F6-42D1-48CF-DF6C6EA9983E"+"UZ"+now)+"."+now;
        api.ajax({
            url: 'https://www.apicloud.com/mcm/api/recommend_custom',
            method: 'POST',
            headers:{
            "X-APICloud-AppId": "A6006620792786",
            "X-APICloud-AppKey":appKey
            },
            data:{
                values:{
                    customer_name:customername,
                    customer_phone:customer_tel,
                    references_phone:references_phone
                    }
            }
        },
        function(ret, err){
            if (ret) {
                UILoading.closeFlower ({
                    id: flowerid
                });
                api.toast({
                    msg: '提交成功',
                    duration: 2000,
                    location: 'bottom'
                });
                Obj_customer_name.value = "";
                Obj_customer_tel.value = "";
            } else {
                alert(JSON.stringify(err));
                UILoading.closeFlower ({
                    id: flowerid
                });
            }

        }
        );
    };
</script>

</html>
